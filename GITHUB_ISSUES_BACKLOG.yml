# GitHub Issues Backlog - YAML Format for Bulk Import
# Generated: 2025-12-06
# Total Issues: 29

metadata:
  audit_date: "2025-12-06"
  session_id: "claude/tech-audit-architecture-01SEK6QJHHUnYyWEDb4mJ7Ey"
  total_issues: 29
  estimated_effort_days: "12-19"

issues:
  # ===========================================================================
  # HIGH PRIORITY (P0) - Must-Do for Production
  # ===========================================================================

  - id: H1
    title: "Verify Lead → LTV Event Chain with Integration Test"
    priority: critical
    type: testing
    area: domain
    effort: "2-3 hours"
    labels:
      - "priority: critical"
      - "type: testing"
      - "area: domain"
    description: |
      The Lead → LTV business flow lacks end-to-end verification. While individual
      components work, there's no integration test proving the complete event chain:
      LeadCreated → LeadScored → LeadQualified → CaseCreated → PaymentReceived → LTVUpdated
    acceptance_criteria:
      - Integration test traces a lead from creation to LTV calculation
      - All domain events are emitted in correct order
      - Event store contains complete audit trail
      - LTV dashboard reflects accurate values after flow completion
      - Test runs in CI pipeline
    files:
      - packages/domain/src/leads/entities/Lead.ts
      - packages/domain/src/ltv/ltv-service.ts
      - packages/domain/src/cases/repositories/CaseRepository.ts
      - apps/trigger/src/workflows/lead-scoring.ts
      - apps/trigger/src/workflows/patient-journey.ts
      - supabase/migrations/20251206000001_cases_payments.sql

  - id: H2
    title: "Wire Cognitive Memory to Agent Guidance Flows"
    priority: critical
    type: feature
    area: cognitive-memory
    effort: "3-4 hours"
    labels:
      - "priority: critical"
      - "type: feature"
      - "area: cognitive-memory"
    description: |
      The Cognitive Memory module (episode builder, memory retrieval) is fully
      implemented but not integrated into agent-facing flows. Agents don't benefit
      from patient history during calls.
    acceptance_criteria:
      - MemoryRetrievalService injected into guidance service
      - Agent scripts receive relevant patient context from episodic memory
      - Recent interactions displayed in agent workspace (when built)
      - Semantic search used for "similar past interactions"
      - "Performance: retrieval < 200ms p95"
    files:
      - packages/core/src/cognitive/memory-retrieval.ts
      - packages/core/src/cognitive/episode-builder.ts
      - packages/domain/src/guidance/
      - packages/domain/src/voice/supervisor-agent.ts
      - apps/trigger/src/tasks/whatsapp-handler.ts

  - id: H3
    title: "Add Critical E2E Tests for Core Flows"
    priority: critical
    type: testing
    area: e2e
    effort: "4-6 hours"
    labels:
      - "priority: critical"
      - "type: testing"
      - "area: e2e"
    description: |
      Currently only 4 E2E tests exist. Medical software requires comprehensive
      E2E coverage of critical flows.
    acceptance_criteria:
      - "E2E test: Complete booking flow (search slot → book → confirm)"
      - "E2E test: Payment flow (create invoice → process payment → receipt)"
      - "E2E test: Lead scoring flow (receive message → score → triage)"
      - "E2E test: Consent management (grant → verify → withdraw)"
      - "E2E test: GDPR data export request"
      - All tests run in CI with Playwright
      - Test data isolated per run
    files:
      - apps/web/e2e/
      - apps/web/playwright.config.ts
      - .github/workflows/ci.yml

  - id: H4
    title: "Load Test RLS Policies for Performance Validation"
    priority: critical
    type: testing
    area: database
    effort: "3-4 hours"
    labels:
      - "priority: critical"
      - "type: testing"
      - "area: database"
    description: |
      Row-Level Security policies are implemented but not validated under load.
      RLS can cause significant query slowdown with large datasets.
    acceptance_criteria:
      - k6 load test with 10K+ records per table
      - Query latency < 100ms p95 with RLS enabled
      - Compare RLS-on vs RLS-off performance
      - Document any policies needing optimization
      - Test multi-tenant isolation under concurrent load
    files:
      - supabase/migrations/20240101000017_rls_policies.sql
      - scripts/k6/

  - id: H5
    title: "Implement Basic Agent Workspace UI"
    priority: critical
    type: feature
    area: frontend
    effort: "1-2 days"
    labels:
      - "priority: critical"
      - "type: feature"
      - "area: frontend"
    description: |
      Backend routing, SLA monitoring, and disposition tracking exist, but agents
      have no native MedicalCor UI. They must use external tools.
    acceptance_criteria:
      - Agent can view assigned queue with priority sorting
      - Agent can accept/reject incoming tasks
      - Agent can see lead context (name, score, history) on accept
      - Agent can set disposition code after call
      - Agent can add follow-up notes
      - Real-time queue updates via WebSocket
      - Mobile-responsive layout
    files:
      - apps/web/src/app/agent-workspace/
      - packages/domain/src/routing/skill-routing-service.ts
      - apps/api/src/routes/supervisor-ws.ts

  - id: H6
    title: "Add Database Partitioning for Event Tables"
    priority: critical
    type: infrastructure
    area: database
    effort: "4-6 hours"
    labels:
      - "priority: critical"
      - "type: infrastructure"
      - "area: database"
    description: |
      domain_events and audit_log tables will grow unbounded. Without partitioning,
      query performance will degrade and maintenance will become problematic.
    acceptance_criteria:
      - domain_events partitioned by month (range on created_at)
      - audit_log partitioned by month
      - Automated partition creation (1 month ahead)
      - Old partitions can be archived/dropped independently
      - Zero downtime migration from existing data
      - Documented retention policy per partition
    files:
      - supabase/migrations/
      - apps/trigger/src/jobs/cron-jobs.ts

  - id: H7
    title: "Production Secrets Audit and Rotation Procedure"
    priority: critical
    type: security
    area: infrastructure
    effort: "2-3 hours"
    labels:
      - "priority: critical"
      - "type: security"
      - "area: infrastructure"
    description: |
      Ensure no secrets exist in codebase, all secrets are rotatable, and
      rotation procedures are documented.
    acceptance_criteria:
      - Gitleaks scan passes with zero findings
      - All secrets documented in .env.example with descriptions
      - Each secret has documented rotation procedure
      - Rotation can be done without downtime
      - Secret access logged in audit trail
      - Emergency rotation runbook exists
    files:
      - .env.example
      - .env.production.template
      - .gitleaks.toml
      - packages/core/src/secrets-validator.ts
      - docs/runbooks/secret-rotation.md

  - id: H8
    title: "Complete Knowledge Graph Migration and Integration"
    priority: critical
    type: feature
    area: cognitive-memory
    effort: "4-6 hours"
    labels:
      - "priority: critical"
      - "type: feature"
      - "area: cognitive-memory"
    description: |
      ADR-004 references knowledge_entities and knowledge_relations tables but
      these are not in migrations. Cognitive memory is incomplete without graph.
    acceptance_criteria:
      - Migration adds knowledge_entities table with embeddings
      - Migration adds knowledge_relations table with typed edges
      - Entity extraction integrated into episode builder
      - Graph queries available in memory retrieval service
      - GDPR erasure includes knowledge graph cleanup
      - Basic visualization available for debugging
    files:
      - supabase/migrations/
      - packages/core/src/cognitive/episode-builder.ts
      - packages/core/src/cognitive/memory-retrieval.ts
      - packages/core/src/cognitive/knowledge-graph.ts

  # ===========================================================================
  # MEDIUM PRIORITY (P1) - Top 1% Level
  # ===========================================================================

  - id: M1
    title: "Consolidate Audit Tables into Unified Schema"
    priority: high
    type: refactor
    area: database
    effort: "4-6 hours"
    labels:
      - "priority: high"
      - "type: refactor"
      - "area: database"
    acceptance_criteria:
      - Single unified_audit_log table with type discriminator
      - All existing audit data migrated
      - Audit insertion abstracted through single service
      - Backwards-compatible views for legacy queries
      - Indexes optimized for common query patterns
    files:
      - supabase/migrations/
      - packages/core/src/observability/audit.ts

  - id: M2
    title: "Implement Predicted LTV (pLTV) Model Infrastructure"
    priority: high
    type: feature
    area: analytics
    effort: "2-3 days"
    labels:
      - "priority: high"
      - "type: feature"
      - "area: analytics"
    acceptance_criteria:
      - pLTV model interface defined
      - Feature extraction from lead attributes
      - Model serving infrastructure (or API integration)
      - pLTV score displayed on lead cards
      - pLTV used in lead routing decisions
      - Model retraining pipeline defined
    files:
      - packages/domain/src/ltv/pltv-service.ts
      - packages/domain/src/ltv/pltv-model.ts
      - apps/web/src/app/ltv-dashboard/
      - apps/trigger/src/workflows/lead-scoring.ts

  - id: M3
    title: "Implement Patient Aggregate with Full Lifecycle"
    priority: high
    type: feature
    area: domain
    effort: "1-2 days"
    labels:
      - "priority: high"
      - "type: feature"
      - "area: domain"
    acceptance_criteria:
      - PatientAggregateRoot with lifecycle states
      - "Domain events: PatientOnboarded, PatientActivated, PatientChurned"
      - Conversion from Lead preserves history
      - Patient timeline view in UI
      - Retention scoring linked to patient aggregate
    files:
      - packages/domain/src/patients/
      - packages/domain/src/patients/entities/Patient.ts
      - packages/domain/src/patients/events/

  - id: M4
    title: "Wire Feature Flags to Runtime UI"
    priority: high
    type: feature
    area: infrastructure
    effort: "3-4 hours"
    labels:
      - "priority: high"
      - "type: feature"
      - "area: infrastructure"
    acceptance_criteria:
      - FeatureFlagProvider React context
      - useFeatureFlag(flagName) hook
      - Admin UI for viewing/toggling flags
      - Rollout percentage support
      - Audit log for flag changes
      - SSR-compatible flag evaluation
    files:
      - apps/web/src/lib/feature-flags/
      - apps/web/src/app/settings/feature-flags/page.tsx
      - supabase/migrations/20251206000007_feature_flags.sql

  - id: M5
    title: "Add Real-Time Queue Visualization Dashboard"
    priority: high
    type: feature
    area: frontend
    effort: "4-6 hours"
    labels:
      - "priority: high"
      - "type: feature"
      - "area: frontend"
    acceptance_criteria:
      - Dashboard showing all active queues
      - "Real-time metrics: wait time, queue depth, SLA status"
      - Visual SLA breach alerts
      - Historical queue performance charts
      - Drill-down to individual agents in queue
      - WebSocket updates for live data
    files:
      - apps/web/src/app/queues/page.tsx
      - supabase/migrations/20251206000002_queue_sla.sql
      - apps/api/src/routes/supervisor-ws.ts

  - id: M6
    title: "Complete Async Embedding Worker Pipeline"
    priority: high
    type: feature
    area: cognitive-memory
    effort: "3-4 hours"
    labels:
      - "priority: high"
      - "type: feature"
      - "area: cognitive-memory"
    acceptance_criteria:
      - Domain events trigger embedding worker
      - Batch processing for efficiency
      - Retry logic for API failures
      - Cron job for embedding refresh (stale embeddings)
      - Metrics for embedding pipeline health
      - Backfill command for historical data
    files:
      - apps/trigger/src/tasks/embedding-worker.ts
      - apps/trigger/src/jobs/embedding-refresh.ts
      - packages/core/src/cognitive/episode-builder.ts

  - id: M7
    title: "Add Cohort LTV Analysis View"
    priority: high
    type: feature
    area: analytics
    effort: "4-6 hours"
    labels:
      - "priority: high"
      - "type: feature"
      - "area: analytics"
    acceptance_criteria:
      - Cohort definition by first contact month
      - LTV progression over time per cohort
      - Cohort comparison visualization
      - Export cohort data for analysis
      - Materialized view for performance
    files:
      - packages/domain/src/ltv/cohort-analysis.ts
      - apps/web/src/app/ltv-dashboard/cohorts/page.tsx
      - supabase/migrations/

  - id: M8
    title: "Create Operational Runbooks"
    priority: high
    type: documentation
    area: operations
    effort: "4-6 hours"
    labels:
      - "priority: high"
      - "type: documentation"
      - "area: operations"
    acceptance_criteria:
      - Incident response runbook (detection → triage → resolution)
      - Rollback procedure for each service
      - Database recovery procedure
      - Scaling playbook (manual and automated)
      - On-call rotation setup guide
      - Postmortem template
    files:
      - docs/runbooks/incident-response.md
      - docs/runbooks/rollback.md
      - docs/runbooks/database-recovery.md
      - docs/runbooks/scaling.md

  - id: M9
    title: "Enhance Circuit Breaker Dashboard"
    priority: medium
    type: feature
    area: observability
    effort: "2-3 hours"
    labels:
      - "priority: medium"
      - "type: feature"
      - "area: observability"
    acceptance_criteria:
      - Real-time circuit state (open/closed/half-open)
      - Failure rate metrics per circuit
      - Manual circuit trip/reset capability
      - Historical state changes timeline
      - Alerts when circuits open
    files:
      - apps/web/src/app/circuit-breaker/page.tsx
      - packages/core/src/circuit-breaker.ts

  - id: M10
    title: "Implement Data Lineage Visualization"
    priority: medium
    type: feature
    area: compliance
    effort: "4-6 hours"
    labels:
      - "priority: medium"
      - "type: feature"
      - "area: compliance"
    acceptance_criteria:
      - Graph visualization of data flows
      - Filter by data subject or resource
      - Trace upstream sources for any data point
      - Trace downstream impact of data changes
      - Export lineage report for auditors
      - HIPAA/GDPR compliance view
    files:
      - apps/web/src/app/data-lineage/page.tsx
      - supabase/migrations/20251206000006_data_lineage.sql
      - packages/core/src/data-lineage/

  - id: M11
    title: "Complete Supervisor Live Monitoring UI"
    priority: medium
    type: feature
    area: frontend
    effort: "4-6 hours"
    labels:
      - "priority: medium"
      - "type: feature"
      - "area: frontend"
    acceptance_criteria:
      - View all active calls with status
      - Listen mode (silent monitoring)
      - Whisper mode (speak to agent only)
      - Barge mode (join call)
      - Real-time transcript view
      - Sentiment indicators
      - Quick escalation actions
    files:
      - apps/web/src/app/supervisor/page.tsx
      - packages/domain/src/voice/supervisor-agent.ts
      - supabase/migrations/20251206000002_supervisor_state_persistence.sql

  - id: M12
    title: "Add Contract Testing for External Integrations"
    priority: medium
    type: testing
    area: integrations
    effort: "4-6 hours"
    labels:
      - "priority: medium"
      - "type: testing"
      - "area: integrations"
    acceptance_criteria:
      - Pact contract tests for HubSpot API
      - Pact contract tests for Stripe webhooks
      - Pact contract tests for WhatsApp/360dialog
      - Contract verification in CI
      - Provider state management for test scenarios
    files:
      - packages/integrations/src/__tests__/contracts/
      - packages/integrations/src/hubspot.ts
      - packages/integrations/src/stripe.ts

  - id: M13
    title: "Add Request Tracing Visualization"
    priority: medium
    type: feature
    area: observability
    effort: "3-4 hours"
    labels:
      - "priority: medium"
      - "type: feature"
      - "area: observability"
    acceptance_criteria:
      - Search traces by correlation ID
      - Waterfall view of request flow
      - Service-to-service hops visible
      - Latency breakdown per hop
      - Error highlighting in trace
      - Link to related logs
    files:
      - apps/web/src/app/traces/page.tsx
      - packages/core/src/observability/instrumentation.ts

  # ===========================================================================
  # LOW PRIORITY (P2) - Polish
  # ===========================================================================

  - id: L1
    title: "Add Comprehensive Storybook Coverage"
    priority: low
    type: documentation
    area: frontend
    effort: "4-6 hours"
    labels:
      - "priority: low"
      - "type: documentation"
      - "area: frontend"
    acceptance_criteria:
      - Stories for all components/ui/ primitives
      - Stories for key feature components
      - Interactive controls for props
      - Accessibility addon configured
      - Deployed Storybook for team reference
    files:
      - apps/web/.storybook/
      - apps/web/src/components/ui/__stories__/

  - id: L2
    title: "Implement Proper Dark Mode Toggle"
    priority: low
    type: feature
    area: frontend
    effort: "2-3 hours"
    labels:
      - "priority: low"
      - "type: feature"
      - "area: frontend"
    acceptance_criteria:
      - Dark mode toggle in header/settings
      - System preference detection
      - Preference persisted in localStorage
      - Smooth transition animation
      - All components properly themed
    files:
      - apps/web/src/app/layout.tsx
      - apps/web/src/components/providers.tsx
      - apps/web/src/globals.css

  - id: L3
    title: "Create API Documentation Portal"
    priority: low
    type: documentation
    area: api
    effort: "3-4 hours"
    labels:
      - "priority: low"
      - "type: documentation"
      - "area: api"
    acceptance_criteria:
      - OpenAPI spec generated from routes
      - Hosted docs (Redoc or Swagger UI)
      - Authentication examples
      - Request/response examples
      - Webhook payload documentation
    files:
      - apps/api/src/routes/
      - apps/api/openapi.json
      - docs/api/

  - id: L4
    title: "Optimize Vector Search Performance"
    priority: low
    type: performance
    area: database
    effort: "2-3 hours"
    labels:
      - "priority: low"
      - "type: performance"
      - "area: database"
    acceptance_criteria:
      - Benchmark current query performance
      - Tune HNSW parameters (m, ef_construction, ef_search)
      - Document optimal settings
      - Add performance regression test
    files:
      - packages/infrastructure/src/ai/vector-search/PgVectorService.ts
      - supabase/migrations/20240101000005_pgvector_rag.sql

  - id: L5
    title: "Add Mobile-Responsive Agent UI"
    priority: low
    type: feature
    area: frontend
    effort: "3-4 hours"
    labels:
      - "priority: low"
      - "type: feature"
      - "area: frontend"
    depends_on: H5
    acceptance_criteria:
      - Responsive breakpoints for tablet (768px+)
      - Touch-friendly controls
      - Collapsible sidebar
      - Swipe gestures for common actions
    files:
      - apps/web/src/app/agent-workspace/

  - id: L6
    title: "Implement Webhook Replay UI"
    priority: low
    type: feature
    area: debugging
    effort: "3-4 hours"
    labels:
      - "priority: low"
      - "type: feature"
      - "area: debugging"
    acceptance_criteria:
      - View recent webhook deliveries
      - Filter by source (WhatsApp, Stripe, etc.)
      - Replay individual webhooks
      - View request/response details
      - Diff between original and replay
    files:
      - apps/web/src/app/webhooks/page.tsx
      - apps/api/src/routes/webhooks/

  - id: L7
    title: "Add Performance Budgets and Lighthouse CI"
    priority: low
    type: infrastructure
    area: performance
    effort: "2-3 hours"
    labels:
      - "priority: low"
      - "type: infrastructure"
      - "area: performance"
    acceptance_criteria:
      - Lighthouse CI configured
      - Performance budgets defined
      - CI fails on budget violations
      - Core Web Vitals dashboard
      - Bundle size tracking
    files:
      - .github/workflows/ci.yml
      - lighthouserc.js
      - apps/web/

  - id: L8
    title: "Complete Localization Coverage"
    priority: low
    type: feature
    area: i18n
    effort: "3-4 hours"
    labels:
      - "priority: low"
      - "type: feature"
      - "area: i18n"
    acceptance_criteria:
      - Audit all translation keys
      - Complete Romanian translations
      - Add language switcher UI
      - Validate no missing keys in CI
      - Document translation workflow
    files:
      - apps/web/src/lib/i18n/
      - apps/web/src/lib/i18n/locales/

# ===========================================================================
# Summary
# ===========================================================================

summary:
  high_priority:
    count: 8
    effort: "3-5 days"
  medium_priority:
    count: 13
    effort: "6-10 days"
  low_priority:
    count: 8
    effort: "3-4 days"
  total:
    count: 29
    effort: "12-19 days"
